<html>
<head>
    <style>
        .error {
            border: 1px solid red;
        }
    </style>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>

    <script src="state.js"></script>

    <script type="text/javascript">
        $(function() {
            var username = stateful($('#username')).state({
                empty: {},
                available: {},
                valid: {
                    change: function(value) {
                        if (!value) {
                            this.object.addClass('error');
                        } else {
                            this.object.removeClass('error');
                        }
                    },

                    compute: function() {
                        return !this.state('empty') && this.state('available');
                    }
                }
            }).behavior({
                keyup: function() {
                    this.state('available', (Math.random() > 0.5));
                    this.state('empty', _.isEmpty(this.object.val()));
                }
            });
        });
    </script>
</head>
<body>
    <input type="text" id="username" />
</body>
</html>